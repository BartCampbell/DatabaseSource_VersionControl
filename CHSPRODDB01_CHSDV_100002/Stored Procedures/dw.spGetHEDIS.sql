SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


---- =============================================
---- Author:		Travis Parker
---- Create date:	10/06/2016
---- Description:	Gets the latest HEDIS data for loading into the DW
---- Usage:			
----		  EXECUTE dw.spGetHEDIS '06/10/2016'
---- =============================================
CREATE PROC [dw].[spGetHEDIS]
    @LastLoadTime DATETIME
AS
    SET NOCOUNT ON; 

    SELECT DISTINCT
            h.HEDIS_BK ,
		  s.S_HEDISDetail_RK ,
            s.H_HEDIS_RK ,
            s.CLIENT ,
            s.CLIENT_MEMBER_STATUS ,
            s.PRODUCT_ROLLUP_ID ,
            s.MEM_NBR ,
            s.MMS_MED ,
            s.MMS_RX ,
            s.MMS_MH_INP ,
            s.MMS_MH_INT ,
            s.MMS_MH_AMB ,
            s.MMS_CD_INP ,
            s.MMS_CD_INT ,
            s.MMS_CD_AMB ,
            s.MMS_DENT ,
            s.AAP_DEN1 ,
            s.AAP_DEN2 ,
            s.AAP_DEN3 ,
            s.AAP_NUM1 ,
            s.AAP_NUM2 ,
            s.AAP_NUM3 ,
            s.CAP_DEN1 ,
            s.CAP_DEN2 ,
            s.CAP_DEN3 ,
            s.CAP_DEN4 ,
            s.CAP_NUM1 ,
            s.CAP_NUM2 ,
            s.CAP_NUM3 ,
            s.CAP_NUM4 ,
            s.PPC_DEN ,
            s.PPC_NUM1 ,
            s.PPC_NUM2 ,
            s.ADV_DEN1 ,
            s.ADV_DEN2 ,
            s.ADV_DEN3 ,
            s.ADV_DEN4 ,
            s.ADV_DEN5 ,
            s.ADV_DEN6 ,
            s.ADV_NUM1 ,
            s.ADV_NUM2 ,
            s.ADV_NUM3 ,
            s.ADV_NUM4 ,
            s.ADV_NUM5 ,
            s.ADV_NUM6 ,
            s.IET_DEN1 ,
            s.IET_DEN2 ,
            s.IET_NUM1_1 ,
            s.IET_NUM1_2 ,
            s.IET_NUM2_1 ,
            s.IET_NUM2_2 ,
            s.APP_DEN1 ,
            s.APP_DEN2 ,
            s.APP_DEN3 ,
            s.APP_NUM1 ,
            s.APP_NUM2 ,
            s.APP_NUM3 ,
            s.CIS_DEN ,
            s.CIS_NUM1 ,
            s.CIS_NUM2 ,
            s.CIS_NUM3 ,
            s.CIS_NUM4 ,
            s.CIS_NUM5 ,
            s.CIS_NUM6 ,
            s.CIS_NUM7 ,
            s.CIS_NUM8 ,
            s.CIS_NUM9 ,
            s.CIS_NUM10 ,
            s.CIS_NUM11 ,
            s.CIS_NUM12 ,
            s.CIS_NUM13 ,
            s.CIS_NUM14 ,
            s.CIS_NUM15 ,
            s.CIS_NUM16 ,
            s.CIS_NUM17 ,
            s.CIS_NUM18 ,
            s.CIS_NUM19 ,
            s.URI_DEN ,
            s.URI_NUM ,
            s.CWP_DEN ,
            s.CWP_NUM ,
            s.COL_DEN ,
            s.COL_NUM ,
            s.BCS_DEN ,
            s.BCS_NUM ,
            s.CCS_DEN ,
            s.CCS_NUM ,
            s.CHL_DEN1 ,
            s.CHL_DEN2 ,
            s.CHL_NUM1 ,
            s.CHL_NUM2 ,
            s.OMW_DEN ,
            s.OMW_NUM ,
            s.CBP_DEN ,
            s.CBP_NUM ,
            s.PBH_DEN ,
            s.PBH_NUM ,
            s.CMC_DEN ,
            s.CDC_DEN3 ,
            s.CMC_NUM1 ,
            s.CMC_NUM2 ,
            s.CMC_NUM3 ,
            s.CDC_DEN ,
            s.CDC_NUM1 ,
            s.CDC_NUM2 ,
            s.CDC_NUM3 ,
            s.CDC_NUM4 ,
            s.CDC_NUM5 ,
            s.CDC_NUM6 ,
            s.CDC_NUM7 ,
            s.CDC_NUM8 ,
            s.CDC_NUM9 ,
            s.CDC_NUM10 ,
            s.ASM_DEN1 ,
            s.ASM_DEN2 ,
            s.ASM_DEN3 ,
            s.ASM_DEN4 ,
            s.ASM_NUM1 ,
            s.ASM_NUM2 ,
            s.ASM_NUM3 ,
            s.ASM_NUM4 ,
            s.FUH_DEN ,
            s.FUH_NUM1 ,
            s.FUH_NUM2 ,
            s.AMM_DEN ,
            s.AMM_NUM1 ,
            s.AMM_NUM2 ,
            s.AMM_NUM3 ,
            s.GSO_DEN ,
            s.GSO_NUM ,
            s.LBP_DEN ,
            s.LBP_NUM ,
            s.AAB_DEN ,
            s.AAB_NUM ,
            s.SPR_DEN ,
            s.SPR_NUM ,
            s.ADD_DEN1 ,
            s.ADD_NUM1 ,
            s.ADD_DEN2 ,
            s.ADD_NUM2 ,
            s.ART_DEN ,
            s.ART_NUM ,
            s.MPM_DEN1 ,
            s.MPM_DEN2 ,
            s.MPM_DEN3 ,
            s.MPM_DEN4 ,
            s.MPM_NE1 ,
            s.MPM_NE2 ,
            s.MPM_NE3 ,
            s.MPM_NE4 ,
            s.DAE_DEN ,
            s.DAE_NUM1 ,
            s.DAE_NUM2 ,
            s.DDE_DEN1 ,
            s.DDE_DEN2 ,
            s.DDE_DEN3 ,
            s.DDE_NUM1 ,
            s.DDE_NUM2 ,
            s.DDE_NUM3 ,
            s.PCE_DEN ,
            s.PCE_NUM1 ,
            s.PCE_NUM2 ,
            s.LSC_DEN ,
            s.LSC_NUM ,
            s.ABA_DEN ,
            s.ABA_NUM ,
            s.WCC_DEN1_1 ,
            s.WCC_NUM1_1 ,
            s.WCC_DEN1_2 ,
            s.WCC_NUM1_2 ,
            s.WCC_DEN2_1 ,
            s.WCC_NUM2_1 ,
            s.WCC_DEN2_2 ,
            s.WCC_NUM2_2 ,
            s.WCC_DEN3_1 ,
            s.WCC_NUM3_1 ,
            s.WCC_DEN3_2 ,
            s.WCC_NUM3_2 ,
            s.COA_DEN ,
            s.COA_NUM1 ,
            s.COA_NUM2 ,
            s.COA_NUM3 ,
            s.COA_NUM4 ,
            s.MRP_DEN ,
            s.MRP_NUM ,
            s.IMA_DEN ,
            s.IMA_NUM1 ,
            s.IMA_NUM2 ,
            s.IMA_NUM3 ,
            s.HPV_DEN ,
            s.HPV_NUM ,
            s.MMA_DEN1 ,
            s.MMA_NUM1_1 ,
            s.MMA_NUM1_2 ,
            s.MMA_DEN2 ,
            s.MMA_NUM2_1 ,
            s.MMA_NUM2_2 ,
            s.MMA_DEN3 ,
            s.MMA_NUM3_1 ,
            s.MMA_NUM3_2 ,
            s.MMA_DEN4 ,
            s.MMA_NUM4_1 ,
            s.MMA_NUM4_2 ,
            s.MMA_DEN5 ,
            s.MMA_NUM5_1 ,
            s.MMA_NUM5_2 ,
            s.MMA_DEN6 ,
            s.MMA_NUM6_1 ,
            s.MMA_NUM6_2 ,
            s.AMR_DEN1 ,
            s.AMR_DEN2 ,
            s.AMR_DEN3 ,
            s.AMR_DEN4 ,
            s.AMR_DEN5 ,
            s.AMR_DEN6 ,
            s.AMR_NUM1 ,
            s.AMR_NUM2 ,
            s.AMR_NUM3 ,
            s.AMR_NUM4 ,
            s.AMR_NUM5 ,
            s.AMR_NUM6 ,
            s.SMD_DEN ,
            s.SMD_NUM ,
            s.SAA_DEN ,
            s.SAA_NUM ,
            s.SSD_DEN ,
            s.SSD_NUM ,
            s.SMC_DEN ,
            s.SMC_NUM ,
            s.NCS_DEN ,
            s.NCS_NUM ,
            s.PSA_DEN ,
            s.PSA_NUM ,
            s.APC_DEN1 ,
            s.APC_DEN2 ,
            s.APC_DEN3 ,
            s.APC_NUM1 ,
            s.APC_NUM2 ,
            s.APC_NUM3 ,
            s.APM_DEN1 ,
            s.APM_DEN2 ,
            s.APM_DEN3 ,
            s.APM_NUM1 ,
            s.APM_NUM2 ,
            s.APM_NUM3 ,
            s.FPC_DEN ,
            s.FPC_NUM1 ,
            s.FPC_NUM2 ,
            s.FPC_NUM3 ,
            s.FPC_NUM4 ,
            s.FPC_NUM5 ,
            s.W15_DEN ,
            s.W15_NUM1 ,
            s.W15_NUM2 ,
            s.W15_NUM3 ,
            s.W15_NUM4 ,
            s.W15_NUM5 ,
            s.W15_NUM6 ,
            s.W15_NUM7 ,
            s.W34_DEN ,
            s.W34_NUM ,
            s.AWC_DEN ,
            s.AWC_NUM ,
            s.FSP_CABG ,
            s.FSP_PTCA ,
            s.FSP_CC ,
            s.FSP_CE ,
            s.FSP_RDF ,
            s.FSP_THR ,
            s.FSP_TKR ,
            s.FSP_EXL ,
            s.FSP_CHO ,
            s.FSP_CHC ,
            s.FSP_HYA ,
            s.FSP_HYV ,
            s.FSP_PROS ,
            s.FSP_DC ,
            s.FSP_BACK ,
            s.FSP_MYR ,
            s.FSP_TON ,
            s.FSP_MAST ,
            s.FSP_LUMP ,
            s.FSP_BARI ,
            s.IPU_DISCH_TOT ,
            s.IPU_DAYS_TOT ,
            s.IPU_DISCH_MAT ,
            s.IPU_DAYS_MAT ,
            s.IPU_DISCH_SUR ,
            s.IPU_DAYS_SUR ,
            s.IPU_DISCH_MED ,
            s.IPU_DAYS_MED ,
            s.AMB_OV ,
            s.AMB_ED ,
            s.AMB_AS ,
            s.AMB_OR ,
            s.MPT_ANY ,
            s.MPT_INP ,
            s.MPT_DN ,
            s.MPT_AMB ,
            s.IAD_ANY ,
            s.IAD_INP ,
            s.IAD_DN ,
            s.IAD_AMB ,
            s.TOTAL_ABX_SCRIPTS ,
            s.TOTAL_ABX_DAYS ,
            s.ABX_CONCERN_SCRIPTS ,
            s.ABXQUIN_PMPY ,
            s.ABXZITH_PMPY ,
            s.ABXCEPH2_PMPY ,
            s.ABXCEPH3_PMPY ,
            s.ABXAMOX_PMPY ,
            s.ABXKETO_PMPY ,
            s.ABXCLIND_PMPY ,
            s.ABXMISC_PMPY ,
            s.ABXABSORB_PMPY ,
            s.ABXAMINO_PMPY ,
            s.ABXCEPH1_PMPY ,
            s.ABXLINCO_PMPY ,
            s.ABXMACRO_PMPY ,
            s.ABXPEN_PMPY ,
            s.ABXTET_PMPY ,
            s.ABXMISO_PMPY ,
            s.ABX_ALLOTHER_SCRIPTS ,
            s.PCR_DEN ,
            s.PCR_NUM ,
            s.SUM_WEIGHTS ,
            s.PRED_READM ,
            s.RDI_DEN ,
            s.RDI_EXCL_REQ ,
            s.RAS_DEN ,
            s.RAS_EXCL_REQ ,
            s.RCA_DEN ,
            s.RCA_EXCL_REQ ,
            s.RCO_DEN ,
            s.RCO_EXCL_REQ ,
            s.RHY_DEN ,
            s.RHY_EXCL_REQ ,
            s.EM_COUNT ,
            s.RRU_LOS ,
            s.RX_COUNT ,
            s.PROC_COUNT ,
            s.CAP_INPATIENT ,
            s.CAP_EM_INPATIENT ,
            s.CAP_EM_OUTPATIENT ,
            s.CAP_PROC_INPATIENT ,
            s.CAP_PROC_OUTPATIENT ,
            s.CAP_RX ,
            s.CAP_LAB ,
            s.CAP_IMG ,
            s.NCQA_PRICE_EM_INP ,
            s.NCQA_PRICE_EM_OUT ,
            s.TOTAL_COST_EM ,
            s.NCQA_PRICE_INP ,
            s.TOTAL_COST_INP ,
            s.NCQA_PRICE_PROC_INP ,
            s.NCQA_PRICE_PROC_OUT ,
            s.TOTAL_COST_PROC ,
            s.NCQA_PRICE_RX ,
            s.TOTAL_COST_RX ,
            s.NCQA_PRICE_LAB ,
            s.NCQA_PRICE_IMG ,
            s.LAB_COUNT ,
            s.IMG_COUNT ,
            s.RRU_MMS_MED ,
            s.RRU_MMS_RX ,
            s.ED_COUNT ,
            s.FREQ_CABG ,
            s.FREQ_CE ,
            s.FREQ_PCI ,
            s.FREQ_CC ,
            s.FREQ_CASDT ,
            s.FREQ_CAD_EBCT ,
            s.FREQ_CCT ,
            s.RRU_INP_DISCH ,
            s.RRU_INP_DAYS ,
            s.RRU_IPU_DISCH ,
            s.RRU_IPU_DAYS ,
            s.RRU_IPU_MED_DISCH ,
            s.RRU_IPU_MED_DAYS ,
            s.RRU_IPU_SURG_DISCH ,
            s.RRU_IPU_SURG_DAYS ,
            s.RRU_NON_DISCH ,
            s.RRU_NON_DAYS ,
            s.RX_N1 ,
            s.RX_N2 ,
            s.RX_G1 ,
            s.RX_G2 ,
            s.RRUAG_WEIGHT ,
            s.RASAG_WEIGHT ,
            s.COMORB_WEIGHT ,
            s.RRU_RISK_GROUP ,
            s.RAS_RISK_GROUP ,
            s.SPC_DEN1_1 ,
            s.SPC_DEN2_1 ,
            s.SPC_NUM1_1 ,
            s.SPC_NUM2_1 ,
            s.SPC_DEN1_2 ,
            s.SPC_DEN2_2 ,
            s.SPC_NUM1_2 ,
            s.SPC_NUM2_2 ,
            s.SPD_DEN1 ,
            s.SPD_DEN2 ,
            s.SPD_NUM1 ,
            s.SPD_NUM2 ,
            s.PDC_DEN1 ,
            s.PDC_NUM1 ,
            s.PDC_DEN2 ,
            s.PDC_NUM2 ,
            s.PDC_DEN3 ,
            s.PDC_NUM3 ,
            s.IHU_DEN ,
            s.INP_SUR_CNT ,
            s.INP_MED_CNT ,
            s.INP_TOT_CNT ,
            s.EDU_DEN ,
            s.ER_CNT ,
            s.EXP_ER_CNT ,
            s.HPC_DEN ,
            s.CHRONIC_ACSC_CNT ,
            s.ACUTE_ACSC_CNT ,
            s.HPC_INP_TOT_CNT ,
            s.EXP_INP_HPCA ,
            s.EXP_INP_HPCCH ,
            s.EXP_INP_HPTOT ,
            s.HPCA_PPD_COMORB_WT ,
            s.HPCCH_PPD_COMORB_WT ,
            s.HPCT_PPD_COMORB_WT ,
            s.HPCA_PPD_AGE_WT ,
            s.HPCCH_PPD_AGE_WT ,
            s.HPCT_PPD_AGE_WT ,
            s.HPCA_PPD_BASE_WT ,
            s.HPCCH_PPD_BASE_WT ,
            s.HPCT_PPD_BASE_WT ,
            s.HPCA_PUCD_COMORB_WT ,
            s.HPCCH_PUCD_COMORB_WT ,
            s.HPCT_PUCD_COMORB_WT ,
            s.HPCA_PUCD_AGE_WT ,
            s.HPCCH_PUCD_AGE_WT ,
            s.HPCT_PUCD_AGE_WT ,
            s.HPCA_PUCD_BASE_WT ,
            s.HPCCH_PUCD_BASE_WT ,
            s.HPCT_PUCD_BASE_WT ,
            s.SUR_PPD_COMORB_WT ,
            s.MED_PPD_COMORB_WT ,
            s.TOT_PPD_COMORB_WT ,
            s.SUR_PPD_AGE_WT ,
            s.MED_PPD_AGE_WT ,
            s.TOT_PPD_AGE_WT ,
            s.SUR_PPD_BASE_WT ,
            s.MED_PPD_BASE_WT ,
            s.TOT_PPD_BASE_WT ,
            s.SUR_PUCD_COMORB_WT ,
            s.MED_PUCD_COMORB_WT ,
            s.TOT_PUCD_COMORB_WT ,
            s.SUR_PUCD_AGE_WT ,
            s.MED_PUCD_AGE_WT ,
            s.TOT_PUCD_AGE_WT ,
            s.SUR_PUCD_BASE_WT ,
            s.MED_PUCD_BASE_WT ,
            s.TOT_PUCD_BASE_WT ,
            s.PPV_COMORB_WT ,
            s.PPV_AGE_WT ,
            s.PPV_BASE_WT ,
            s.PUCV_COMORB_WT ,
            s.PUCV_AGE_WT ,
            s.PUCV_BASE_WT ,
            s.[Case Manager] ,
            s.[PHO ID] ,
            s.[PHO Name] ,
            s.[PCP Name] ,
            s.[PCP ID] ,
            s.RecordSource ,
            s.LoadDate ,
		  c.Client_BK AS CentauriClientID ,
		  m.Member_BK AS CentauriMemberID ,
		  p.Provider_BK AS CentauriProviderID
    FROM    dbo.H_HEDIS h 
            INNER JOIN dbo.S_HEDISDetail s ON s.H_HEDIS_RK = h.H_HEDIS_RK
		  LEFT JOIN dbo.L_MemberHEDIS lm ON lm.H_HEDIS_RK = h.H_HEDIS_RK 
		  LEFT JOIN dbo.H_Member m ON m.H_Member_RK = lm.H_Member_RK
		  LEFT JOIN dbo.L_ProviderHEDIS lp ON lp.H_HEDIS_RK = h.H_HEDIS_RK 
		  LEFT JOIN dbo.H_Provider p ON p.H_Provider_RK = lp.H_Provider_RK
		  CROSS JOIN dbo.H_Client c
    WHERE   s.RecordEndDate IS NULL
            AND s.LoadDate > @LastLoadTime;



GO
